<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M&A - Admin Panel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #000000;
            --secondary-color: #ffffff;
            --accent-color: #25D366;
            --discount-color: #e63946;
            --light-gray: #f5f5f5;
            --dark-gray: #333333;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        body {
            background-color: var(--secondary-color);
            color: var(--primary-color);
            padding: 20px;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.8rem;
            font-weight: bold;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--light-gray);
            padding-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 8px 16px;
            cursor: pointer;
            border-radius: 4px;
        }
        
        .tab.active {
            background-color: var(--accent-color);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--light-gray);
            border-radius: 4px;
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }
        
        .btn-primary {
            background-color: var(--accent-color);
            color: white;
        }
        
        .btn-secondary {
            background-color: var(--light-gray);
            color: var(--primary-color);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--light-gray);
        }
        
        th {
            background-color: var(--light-gray);
            font-weight: 600;
        }
        
        .product-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 4px;
        }
        
        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            margin: 0 5px;
            padding: 5px;
        }
        
        .edit-btn {
            color: var(--accent-color);
        }
        
        .delete-btn {
            color: var(--discount-color);
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .in-stock {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .sold-out {
            background-color: #ffebee;
            color: #c62828;
        }
        
        .categories-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }
        
        .category-card {
            background-color: var(--secondary-color);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            width: calc(33.333% - 10px);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .category-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 4px;
            margin-right: 15px;
        }
        
        .category-info {
            display: flex;
            align-items: center;
            flex: 1;
        }
        
        .category-actions {
            display: flex;
            gap: 5px;
        }
        
        .image-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .image-preview-item {
            position: relative;
            width: 100px;
            height: 100px;
        }
        
        .image-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 4px;
        }
        
        .image-preview-item .remove-image {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: var(--discount-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
        }
        
        .upload-area {
            border: 2px dashed var(--light-gray);
            border-radius: 4px;
            padding: 20px;
            text-align: center;
            margin-bottom: 15px;
            cursor: pointer;
            transition: border-color 0.3s;
        }
        
        .upload-area:hover {
            border-color: var(--accent-color);
        }
        
        .upload-area i {
            font-size: 2rem;
            color: var(--accent-color);
            margin-bottom: 10px;
        }
        
        .progress-container {
            margin-top: 10px;
            display: none;
        }
        
        .progress-bar {
            width: 100%;
            background-color: var(--light-gray);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-bar-fill {
            height: 20px;
            background-color: var(--accent-color);
            width: 0%;
            transition: width 0.3s;
        }
        
        .progress-text {
            text-align: center;
            margin-top: 5px;
            font-size: 0.8rem;
        }
        
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .promo-codes-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .promo-card {
            background-color: var(--secondary-color);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .promo-info {
            flex: 1;
        }
        
        .promo-code {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .promo-value {
            color: var(--dark-gray);
        }
        
        .promo-actions {
            display: flex;
            gap: 5px;
        }
        
        .product-card {
            background-color: var(--secondary-color);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .product-card-img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        
        .product-card-body {
            padding: 15px;
        }
        
        .product-card-title {
            font-size: 1.1rem;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .product-card-category {
            font-size: 0.9rem;
            color: var(--dark-gray);
            margin-bottom: 8px;
        }
        
        .product-card-price {
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .product-card-old-price {
            text-decoration: line-through;
            color: var(--dark-gray);
            font-size: 0.9rem;
            margin-left: 5px;
        }
        
        .product-card-discount {
            color: var(--discount-color);
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .product-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            border-top: 1px solid var(--light-gray);
        }
        
        .product-badge {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .badge-best-seller {
            background-color: #e3f2fd;
            color: #1976d2;
        }
        
        .badge-offer {
            background-color: #fff8e1;
            color: #ff8f00;
        }
        
        .users-table-container {
            margin-top: 20px;
            overflow-x: auto;
        }
        
        .download-btn {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 20px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .orders-container {
            margin-top: 20px;
        }
        
        .order-card {
            background-color: var(--secondary-color);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            padding: 15px;
            width: 100%;
        }
        
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .order-id {
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .order-date {
            color: var(--dark-gray);
            font-size: 0.9rem;
        }
        
        .order-customer {
            margin-bottom: 15px;
        }
        
        .customer-name {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 1.1rem;
        }
        
        .customer-details {
            font-size: 0.9rem;
            color: var(--dark-gray);
        }
        
        .order-products {
            margin-bottom: 15px;
        }
        
        .product-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .product-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .product-item-img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 4px;
            margin-right: 10px;
        }
        
        .product-item-details {
            flex: 1;
        }
        
        .product-item-name {
            font-weight: 600;
            margin-bottom: 3px;
        }
        
        .product-item-price {
            font-size: 0.9rem;
            color: var(--dark-gray);
        }
        
        .product-item-quantity {
            font-size: 0.9rem;
            color: var(--dark-gray);
        }
        
        .order-summary {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-top: 10px;
            border-top: 1px solid var(--light-gray);
        }
        
        .order-total {
            font-weight: 600;
        }
        
        .order-status {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .status-select {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid var(--light-gray);
            font-size: 0.9rem;
        }
        
        .status-badge {
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-processing {
            background-color: #e3f2fd;
            color: #1976d2;
        }
        
        .status-shipped {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .status-delivered {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .status-cancelled {
            background-color: #ffebee;
            color: #c62828;
        }
        
        .reviews-container {
            margin-top: 20px;
            overflow-x: auto;
        }
        
        .review-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .review-table th {
            background-color: var(--light-gray);
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }
        
        .review-table td {
            padding: 12px;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .review-rating {
            color: #ffc107;
        }
        
        .announcement-form {
            background-color: var(--light-gray);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .announcement-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--accent-color);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        .active-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .promo-active-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .active-true {
            background-color: #e8f5e9;
            color: #2e7d32;
        }

        .active-false {
            background-color: #ffebee;
            color: #c62828;
        }

        .order-details-toggle {
            background: none;
            border: none;
            color: var(--accent-color);
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .order-details-content {
            margin-top: 15px;
            padding: 15px;
            background-color: var(--light-gray);
            border-radius: 8px;
            display: none;
        }

        .order-details-content.show {
            display: block;
        }

        .detail-row {
            display: flex;
            margin-bottom: 10px;
        }

        .detail-label {
            font-weight: 600;
            width: 150px;
        }

        .detail-value {
            flex: 1;
        }
        
        .analytics-container {
            margin-top: 20px;
        }
        
        .analytics-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .analytics-card {
            background-color: var(--secondary-color);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 20px;
            text-align: center;
        }
        
        .analytics-card h3 {
            margin-bottom: 10px;
            color: var(--dark-gray);
            font-size: 1rem;
        }
        
        .analytics-card .value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent-color);
        }
        
        .analytics-card .subtext {
            font-size: 0.9rem;
            color: var(--dark-gray);
            margin-top: 5px;
        }
        
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .chart-container {
            background-color: var(--secondary-color);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 20px;
            width: 100%;
        }
        
        .chart-container h3 {
            margin-bottom: 15px;
            text-align: center;
        }
        
        .chart-wrapper {
            position: relative;
            height: 300px;
        }
        
        /* New styles for dynamic fields */
        .dynamic-field-container {
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid var(--light-gray);
            border-radius: 4px;
        }
        
        .dynamic-field-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .dynamic-field-row input {
            flex: 1;
        }
        
        .remove-field-btn {
            background-color: var(--discount-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
        }
        
        .add-field-btn {
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .category-card {
                width: 100%;
            }
            
            .products-grid {
                grid-template-columns: 1fr;
            }
            
            .promo-codes-list {
                grid-template-columns: 1fr;
            }
            
            .order-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .order-date {
                margin-top: 5px;
            }
            
            .order-status {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .status-select {
                margin-top: 10px;
                width: 100%;
            }

            .detail-row {
                flex-direction: column;
            }

            .detail-label {
                width: 100%;
                margin-bottom: 5px;
            }
            
            .charts-container {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                padding: 15px;
            }
            
            .chart-wrapper {
                height: 250px;
            }
            
            .dynamic-field-row {
                flex-direction: column;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">
            <span>M&A Admin Panel</span>
        </div>
    </div>
    
    <div class="tabs">
        <div class="tab active" data-tab="products">Add Product</div>
        <div class="tab" data-tab="manage-products">Manage Products</div>
        <div class="tab" data-tab="categories">Categories</div>
        <div class="tab" data-tab="promo-codes">Promo Codes</div>
        <div class="tab" data-tab="orders">Orders</div>
        <div class="tab" data-tab="reviews">Reviews</div>
        <div class="tab" data-tab="users">Users</div>
        <div class="tab" data-tab="announcement">Announcement</div>
        <div class="tab" data-tab="analytics">Analytics</div>
    </div>
    
    <!-- Add Product Tab -->
    <div class="tab-content active" id="products-tab">
        <div class="form-container">
            <form id="productForm">
                <input type="hidden" id="productId">
                <div class="form-row">
                    <div class="form-group">
                        <label for="productName">Product Name</label>
                        <input type="text" id="productName" required>
                    </div>
                    <div class="form-group">
                        <label for="productCategory">Category</label>
                        <select id="productCategory" required>
                            <option value="">Select a category</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="productPrice">Price (EGP)</label>
                        <input type="number" id="productPrice" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="productDescription">Description</label>
                    <textarea id="productDescription"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Colors</label>
                    <div id="colorsContainer"></div>
                    <button type="button" class="btn btn-secondary add-field-btn" id="addColorBtn">Add Color</button>
                </div>
                
                <div class="form-group">
                    <label>Sizes</label>
                    <div id="sizesContainer"></div>
                    <button type="button" class="btn btn-secondary add-field-btn" id="addSizeBtn">Add Size</button>
                </div>
                
                <div class="form-group">
                    <label>Product Images</label>
                    <div class="upload-area" id="uploadArea">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Click to upload images or drag and drop (Multiple allowed)</p>
                        <input type="file" id="fileInput" accept="image/*" multiple style="display: none;">
                    </div>
                    <div class="progress-container" id="progressContainer">
                        <div class="progress-bar">
                            <div class="progress-bar-fill" id="progressBarFill"></div>
                        </div>
                        <div class="progress-text" id="progressText">0%</div>
                    </div>
                    <div class="image-preview" id="imagePreview"></div>
                    <input type="hidden" id="productImageUrls">
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Save Product</button>
                    <button type="button" class="btn btn-secondary" id="cancelProductBtn">Cancel</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Manage Products Tab -->
    <div class="tab-content" id="manage-products-tab">
        <div class="products-grid" id="productsGrid">
            <!-- Products will be loaded here in grid view -->
        </div>
    </div>
    
    <!-- Categories Tab -->
    <div class="tab-content" id="categories-tab">
        <div class="form-container">
            <form id="categoryForm">
                <div class="form-row">
                    <div class="form-group" style="flex: 1;">
                        <label for="categoryName">Category Name</label>
                        <input type="text" id="categoryName" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Category Image</label>
                    <div class="upload-area" id="categoryUploadArea">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Click to upload category image or drag and drop</p>
                        <input type="file" id="categoryFileInput" accept="image/*" style="display: none;">
                    </div>
                    <div class="progress-container" id="categoryProgressContainer">
                        <div class="progress-bar">
                            <div class="progress-bar-fill" id="categoryProgressBarFill"></div>
                        </div>
                    </div>
                    <div class="image-preview" id="categoryImagePreview"></div>
                    <input type="hidden" id="categoryImageUrl">
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Add Category</button>
                </div>
            </form>
        </div>
        
        <div class="categories-list" id="categoriesList">
            <!-- Categories will be loaded here -->
        </div>
    </div>
    
    <!-- Promo Codes Tab -->
    <div class="tab-content" id="promo-codes-tab">
        <div class="form-container">
            <form id="promoCodeForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="promoCode">Promo Code</label>
                        <input type="text" id="promoCode" required>
                    </div>
                    <div class="form-group">
                        <label for="promoDiscount">Discount Value (EGP)</label>
                        <input type="number" id="promoDiscount" min="0" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <div class="active-status">
                            <label for="promoActive">Active:</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="promoActive" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            </div>
                    </div>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Add Promo Code</button>
                </div>
            </form>
        </div>
        
        <div class="promo-codes-list" id="promoCodesList">
            <!-- Promo codes will be loaded here -->
        </div>
    </div>
    
    <!-- Orders Tab -->
    <div class="tab-content" id="orders-tab">
        <h2>Order Management</h2>
        <p>View and manage customer orders.</p>
        
        <div class="orders-container" id="ordersContainer">
            <!-- Orders will be loaded here in card view -->
        </div>
    </div>
    
    <!-- Reviews Tab -->
    <div class="tab-content" id="reviews-tab">
        <h2>Reviews Management</h2>
        <p>View and manage product reviews.</p>
        
        <div class="reviews-container">
            <table class="review-table">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Reviewer</th>
                        <th>Rating</th>
                        <th>Comment</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="reviewsTableBody">
                    <!-- Reviews will be loaded here -->
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Users Tab -->
    <div class="tab-content" id="users-tab">
        <h2>User Management</h2>
        <p>View and download user data from the database.</p>
        
        <div class="users-table-container">
            <table id="usersTable">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Registration Date</th>
                    </tr>
                </thead>
                <tbody id="usersTableBody">
                    <!-- Users will be loaded here -->
                </tbody>
            </table>
        </div>
        
        <button class="download-btn" id="downloadUsersBtn">
            <i class="fas fa-download"></i> Download Users as CSV
        </button>
    </div>

    <!-- Announcement Tab -->
    <div class="tab-content" id="announcement-tab">
        <h2>Announcement Banner</h2>
        <p>Manage the announcement banner displayed to users.</p>
        
        <div class="announcement-form">
            <form id="announcementForm">
                <div class="announcement-toggle">
                    <label for="announcementEnabled">Enable Banner:</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="announcementEnabled">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                
                <div class="form-group">
                    <label for="announcementText">Banner Text</label>
                    <textarea id="announcementText" placeholder="Enter announcement text"></textarea>
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Save Settings</button>
                </div>
            </form>
        </div>
        
        <h3>Preview</h3>
        <div id="announcementPreview" style="background-color: #fff8e1; padding: 15px; border-radius: 8px; display: none;">
            <p id="previewText"></p>
        </div>
    </div>

    <!-- Analytics Tab -->
    <div class="tab-content" id="analytics-tab">
        <h2>Analytics Dashboard</h2>
        <p>View store performance metrics and analytics.</p>
        
        <div class="analytics-container">
            <div class="analytics-cards">
                <div class="analytics-card">
                    <h3>Total Revenue</h3>
                    <div class="value" id="totalRevenue">0 EGP</div>
                    <div class="subtext">From delivered orders only</div>
                </div>
                <div class="analytics-card">
                    <h3>Total Orders</h3>
                    <div class="value" id="totalOrders">0</div>
                    <div class="subtext">All order statuses</div>
                </div>
                <div class="analytics-card">
                    <h3>Delivered Orders</h3>
                    <div class="value" id="deliveredOrders">0</div>
                    <div class="subtext">Completed sales</div>
                </div>
                <div class="analytics-card">
                    <h3>Average Order Value</h3>
                    <div class="value" id="avgOrderValue">0 EGP</div>
                    <div class="subtext">From delivered orders</div>
                </div>
                <div class="analytics-card">
                    <h3>Total Customers</h3>
                    <div class="value" id="totalCustomers">0</div>
                    <div class="subtext">Unique customers</div>
                </div>
                <div class="analytics-card">
                    <h3>Conversion Rate</h3>
                    <div class="value" id="conversionRate">0%</div>
                    <div class="subtext">Orders vs Visitors</div>
                </div>
            </div>
            
            <div class="charts-container">
                <div class="chart-container">
                    <h3>Orders by Status</h3>
                    <div class="chart-wrapper">
                        <canvas id="ordersStatusChart"></canvas>
                    </div>
                </div>
                <div class="chart-container">
                    <h3>Revenue by Month</h3>
                    <div class="chart-wrapper">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>
                <div class="chart-container">
                    <h3>Top Selling Products</h3>
                    <div class="chart-wrapper">
                        <canvas id="topProductsChart"></canvas>
                    </div>
                </div>
                <div class="chart-container">
                    <h3>Category Performance</h3>
                    <div class="chart-wrapper">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>
                <div class="chart-container">
                    <h3>Customer Acquisition</h3>
                    <div class="chart-wrapper">
                        <canvas id="customerChart"></canvas>
                    </div>
                </div>
                <div class="chart-container">
                    <h3>Review Ratings</h3>
                    <div class="chart-wrapper">
                        <canvas id="ratingsChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBQw5JQZ4Q4Q4Q4Q4Q4Q4Q4Q4Q4Q4Q4Q4",
            authDomain: "scarfy-a4794.firebaseapp.com",
            databaseURL: "https://m-and-a-e770b-default-rtdb.firebaseio.com",
            projectId: "m-and-a-e770b",
            storageBucket: "scarfy-a4794.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:1234567890123456789012"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Image upload API key
        const IMGBB_API_KEY = '9863a0b56c4ed85517bda67706e834f8';
        
        // Global variables
        let products = [], categories = [], promoCodes = [], users = [], orders = [], reviews = [];
        let uploadedImages = [], uploadedCategoryImage = null, announcement = { enabled: false, text: "" };
        
        // Chart instances
        let ordersStatusChart = null, revenueChart = null, topProductsChart = null;
        let categoryChart = null, customerChart = null, ratingsChart = null;
        
        // DOM Elements
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const productForm = document.getElementById('productForm');
        const cancelProductBtn = document.getElementById('cancelProductBtn');
        const productsGrid = document.getElementById('productsGrid');
        const categoryForm = document.getElementById('categoryForm');
        const categoriesList = document.getElementById('categoriesList');
        const productCategorySelect = document.getElementById('productCategory');
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const imagePreview = document.getElementById('imagePreview');
        const productImageUrls = document.getElementById('productImageUrls');
        const progressContainer = document.getElementById('progressContainer');
        const progressBarFill = document.getElementById('progressBarFill');
        const progressText = document.getElementById('progressText');
        const promoCodeForm = document.getElementById('promoCodeForm');
        const promoCodesList = document.getElementById('promoCodesList');
        const usersTableBody = document.getElementById('usersTableBody');
        const downloadUsersBtn = document.getElementById('downloadUsersBtn');
        const ordersContainer = document.getElementById('ordersContainer');
        const reviewsTableBody = document.getElementById('reviewsTableBody');
        const announcementForm = document.getElementById('announcementForm');
        const announcementEnabled = document.getElementById('announcementEnabled');
        const announcementText = document.getElementById('announcementText');
        const announcementPreview = document.getElementById('announcementPreview');
        const previewText = document.getElementById('previewText');
        
        // Category image elements
        const categoryUploadArea = document.getElementById('categoryUploadArea');
        const categoryFileInput = document.getElementById('categoryFileInput');
        const categoryImagePreview = document.getElementById('categoryImagePreview');
        const categoryProgressContainer = document.getElementById('categoryProgressContainer');
        const categoryProgressBarFill = document.getElementById('categoryProgressBarFill');
        const categoryImageUrl = document.getElementById('categoryImageUrl');
        
        // Analytics elements
        const totalRevenueEl = document.getElementById('totalRevenue');
        const totalOrdersEl = document.getElementById('totalOrders');
        const deliveredOrdersEl = document.getElementById('deliveredOrders');
        const avgOrderValueEl = document.getElementById('avgOrderValue');
        const totalCustomersEl = document.getElementById('totalCustomers');
        const conversionRateEl = document.getElementById('conversionRate');
        
        // New elements for dynamic fields
        const colorsContainer = document.getElementById('colorsContainer');
        const addColorBtn = document.getElementById('addColorBtn');
        const sizesContainer = document.getElementById('sizesContainer');
        const addSizeBtn = document.getElementById('addSizeBtn');
        const productDescription = document.getElementById('productDescription');
        
        // Initialize Admin Panel
        function initAdminPanel() {
            loadData();
            setupEventListeners();
        }
        
        // Load data from Firebase
        function loadData() {
            // Load products
            database.ref('products').on('value', (snapshot) => {
                const productsData = snapshot.val();
                products = [];
                if (productsData) {
                    products = Object.keys(productsData).map(key => ({ id: key, ...productsData[key] }));
                }
                renderProductsGrid();
                updateAnalytics();
            });
            
            // Load categories
            database.ref('categories').on('value', (snapshot) => {
                const categoriesData = snapshot.val();
                categories = [];
                if (categoriesData) {
                    categories = Object.keys(categoriesData).map(key => ({ 
                        id: key, 
                        name: categoriesData[key].name, 
                        image: categoriesData[key].image || 'https://via.placeholder.com/60' 
                    }));
                }
                renderCategoriesList();
                updateCategorySelect();
                updateAnalytics();
            });
            
            // Load promo codes
            database.ref('promoCodes').on('value', (snapshot) => {
                const promoCodesData = snapshot.val();
                promoCodes = [];
                if (promoCodesData) {
                    promoCodes = Object.keys(promoCodesData).map(key => ({ 
                        id: key, 
                        code: promoCodesData[key].code, 
                        discount: promoCodesData[key].discount, 
                        active: promoCodesData[key].active !== undefined ? promoCodesData[key].active : true 
                    }));
                }
                renderPromoCodesList();
            });
            
            // Load users
            database.ref('users').on('value', (snapshot) => {
                const usersData = snapshot.val();
                users = [];
                if (usersData) {
                    users = Object.keys(usersData).map(key => ({ id: key, ...usersData[key] }));
                }
                renderUsersTable();
                updateAnalytics();
            });
            
            // Load orders
            database.ref('orders').on('value', (snapshot) => {
                const ordersData = snapshot.val();
                orders = [];
                if (ordersData) {
                    orders = Object.keys(ordersData).map(key => ({ id: key, ...ordersData[key] }));
                }
                renderOrdersCards();
                updateAnalytics();
            });
            
            // Load reviews
            database.ref('reviews').on('value', (snapshot) => {
                const reviewsData = snapshot.val();
                reviews = [];
                if (reviewsData) {
                    reviews = Object.keys(reviewsData).map(key => ({ id: key, ...reviewsData[key] }));
                }
                renderReviewsTable();
                updateAnalytics();
            });
            
            // Load announcement
            database.ref('announcementBanner').on('value', (snapshot) => {
                const announcementData = snapshot.val();
                if (announcementData) {
                    announcement = announcementData;
                    announcementEnabled.checked = announcement.enabled;
                    announcementText.value = announcement.text || "";
                    updateAnnouncementPreview();
                }
            });
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Tab switching
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    tab.classList.add('active');
                    document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
                    
                    // If analytics tab is selected, update charts
                    if (tab.dataset.tab === 'analytics') {
                        updateAnalytics();
                    }
                });
            });
            
            // Product form submission
            productForm.addEventListener('submit', (e) => {
                e.preventDefault();
                saveProduct();
            });
            
            // Cancel product form
            cancelProductBtn.addEventListener('click', () => {
                resetProductForm();
            });
            
            // Category form submission
            categoryForm.addEventListener('submit', (e) => {
                e.preventDefault();
                addCategory();
            });
            
            // Promo code form submission
            promoCodeForm.addEventListener('submit', (e) => {
                e.preventDefault();
                addPromoCode();
            });
            
            // Announcement form submission
            announcementForm.addEventListener('submit', (e) => {
                e.preventDefault();
                saveAnnouncement();
            });
            
            // Announcement text change
            announcementText.addEventListener('input', updateAnnouncementPreview);
            announcementEnabled.addEventListener('change', updateAnnouncementPreview);
            
            // Image upload handling for products
            uploadArea.addEventListener('click', () => fileInput.click());
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = 'var(--accent-color)';
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.style.borderColor = 'var(--light-gray)';
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = 'var(--light-gray)';
                if (e.dataTransfer.files.length > 0) {
                    handleFiles(e.dataTransfer.files, 'product');
                }
            });
            
            fileInput.addEventListener('change', () => {
                if (fileInput.files.length > 0) {
                    handleFiles(fileInput.files, 'product');
                }
            });
            
            // Image upload handling for categories
            categoryUploadArea.addEventListener('click', () => categoryFileInput.click());
            
            categoryUploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                categoryUploadArea.style.borderColor = 'var(--accent-color)';
            });
            
            categoryUploadArea.addEventListener('dragleave', () => {
                categoryUploadArea.style.borderColor = 'var(--light-gray)';
            });
            
            categoryUploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                categoryUploadArea.style.borderColor = 'var(--light-gray)';
                if (e.dataTransfer.files.length > 0) {
                    handleFiles(e.dataTransfer.files, 'category');
                }
            });
            
            categoryFileInput.addEventListener('change', () => {
                if (categoryFileInput.files.length > 0) {
                    handleFiles(categoryFileInput.files, 'category');
                }
            });
            
            // Download users button
            downloadUsersBtn.addEventListener('click', downloadUsersCSV);
            
            // Add color and size buttons
            addColorBtn.addEventListener('click', () => addColorField());
            addSizeBtn.addEventListener('click', () => addSizeField());
        }
        
        // Add color field (updated to only use color name)
        function addColorField(colorName = '') {
            const colorField = document.createElement('div');
            colorField.className = 'dynamic-field-container';
            colorField.innerHTML = `
                <div class="dynamic-field-row">
                    <input type="text" placeholder="Color Name" value="${colorName}" class="color-name">
                    <button type="button" class="remove-field-btn">&times;</button>
                </div>
            `;
            colorsContainer.appendChild(colorField);
            
            colorField.querySelector('.remove-field-btn').addEventListener('click', () => {
                colorField.remove();
            });
        }
        
        // Add size field
        function addSizeField(size = '') {
            const sizeField = document.createElement('div');
            sizeField.className = 'dynamic-field-container';
            sizeField.innerHTML = `
                <div class="dynamic-field-row">
                    <input type="text" placeholder="Size" value="${size}" class="size-value">
                    <button type="button" class="remove-field-btn">&times;</button>
                </div>
            `;
            sizesContainer.appendChild(sizeField);
            
            sizeField.querySelector('.remove-field-btn').addEventListener('click', () => {
                sizeField.remove();
            });
        }
        
        // Update announcement preview
        function updateAnnouncementPreview() {
            if (announcementEnabled.checked && announcementText.value) {
                announcementPreview.style.display = 'block';
                previewText.textContent = announcementText.value;
            } else {
                announcementPreview.style.display = 'none';
            }
        }
        
        // Save announcement settings
        function saveAnnouncement() {
            const announcementData = {
                enabled: announcementEnabled.checked,
                text: announcementText.value
            };
            
            database.ref('announcementBanner').set(announcementData)
                .then(() => alert('Announcement settings saved successfully!'))
                .catch(error => alert('Error saving announcement: ' + error.message));
        }
        
        // Reset product form
        function resetProductForm() {
            productForm.reset();
            document.getElementById('productId').value = '';
            imagePreview.innerHTML = '';
            uploadedImages = [];
            productImageUrls.value = '';
            progressContainer.style.display = 'none';
            colorsContainer.innerHTML = '';
            sizesContainer.innerHTML = '';
            productDescription.value = '';
        }
        
        // Handle uploaded files
        function handleFiles(files, type) {
            if (type === 'product') {
                progressContainer.style.display = 'block';
                progressBarFill.style.width = '0%';
                progressText.textContent = '0%';
            } else if (type === 'category') {
                categoryProgressContainer.style.display = 'block';
                categoryProgressBarFill.style.width = '0%';
                categoryImagePreview.innerHTML = '';
                uploadedCategoryImage = null;
            }
            
            const totalFiles = files.length;
            let processedFiles = 0;
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                if (!file.type.match('image.*')) {
                    processedFiles++;
                    updateProgress(processedFiles, totalFiles, type);
                    continue;
                }
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    const imageData = e.target.result;
                    
                    // Upload to ImgBB
                    const formData = new FormData();
                    formData.append('image', imageData.split(',')[1]);
                    
                    fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            if (type === 'product') {
                                uploadedImages.push(data.data.url);
                                addImagePreview(data.data.url, type);
                                productImageUrls.value = JSON.stringify(uploadedImages);
                            } else if (type === 'category') {
                                uploadedCategoryImage = data.data.url;
                                addImagePreview(data.data.url, type);
                                categoryImageUrl.value = uploadedCategoryImage;
                            }
                        }
                        processedFiles++;
                        updateProgress(processedFiles, totalFiles, type);
                    })
                    .catch(error => {
                        console.error('Error uploading image:', error);
                        processedFiles++;
                        updateProgress(processedFiles, totalFiles, type);
                    });
                };
                reader.readAsDataURL(file);
            }
        }
        
        // Update progress
        function updateProgress(processed, total, type) {
            const progress = Math.round((processed / total) * 100);
            
            if (type === 'product') {
                progressBarFill.style.width = `${progress}%`;
                progressText.textContent = `${progress}%`;
                
                if (processed === total) {
                    setTimeout(() => progressContainer.style.display = 'none', 1000);
                }
            } else if (type === 'category') {
                categoryProgressBarFill.style.width = `${progress}%`;
                
                if (processed === total) {
                    setTimeout(() => categoryProgressContainer.style.display = 'none', 1000);
                }
            }
        }
        
        // Add image preview
        function addImagePreview(url, type) {
            if (type === 'product') {
                const previewItem = document.createElement('div');
                previewItem.className = 'image-preview-item';
                previewItem.innerHTML = `
                    <img src="${url}" alt="Preview">
                    <button class="remove-image" data-url="${url}">&times;</button>
                `;
                
                // Add event listener to remove button
                previewItem.querySelector('.remove-image').addEventListener('click', (e) => {
                    e.preventDefault();
                    removeImage(url, type);
                    previewItem.remove();
                });
                
                imagePreview.appendChild(previewItem);
            } else if (type === 'category') {
                categoryImagePreview.innerHTML = `
                    <div class="image-preview-item">
                        <img src="${url}" alt="Category Preview">
                        <button class="remove-image" id="removeCategoryImage">&times;</button>
                    </div>
                `;
                
                // Add event listener to remove button
                document.getElementById('removeCategoryImage').addEventListener('click', (e) => {
                    e.preventDefault();
                    removeImage(url, type);
                    categoryImagePreview.innerHTML = '';
                });
            }
        }
        
        // Remove image from list
        function removeImage(url, type) {
            if (type === 'product') {
                uploadedImages = uploadedImages.filter(imgUrl => imgUrl !== url);
                productImageUrls.value = JSON.stringify(uploadedImages);
            } else if (type === 'category') {
                uploadedCategoryImage = null;
                categoryImageUrl.value = '';
            }
        }
        
        // Render products grid
        function renderProductsGrid() {
            productsGrid.innerHTML = products.map(product => `
                <div class="product-card">
                    <img src="${product.images && product.images.length > 0 ? product.images[0] : 'https://via.placeholder.com/300'}" alt="${product.name}" class="product-card-img">
                    <div class="product-card-body">
                        <h3 class="product-card-title">${product.name}</h3>
                        <div class="product-card-category">${product.category}</div>
                        <div class="product-card-price">
                            ${product.price} EGP
                        </div>
                        <div class="product-card-description">${product.description || ''}</div>
                    </div>
                    <div class="product-card-footer">
                        <button class="btn btn-primary edit-btn" data-id="${product.id}">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn btn-secondary delete-btn" data-id="${product.id}">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </div>
            `).join('');
            
            // Add event listeners to edit and delete buttons
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const productId = btn.dataset.id;
                    editProduct(productId);
                    
                    // Switch to the Add Product tab
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    document.querySelector('.tab[data-tab="products"]').classList.add('active');
                    document.getElementById('products-tab').classList.add('active');
                });
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const productId = btn.dataset.id;
                    if (confirm('Are you sure you want to delete this product?')) {
                        deleteProduct(productId);
                    }
                });
            });
        }
        
        // Render categories list
        function renderCategoriesList() {
            categoriesList.innerHTML = categories.map(category => `
                <div class="category-card">
                    <div class="category-info">
                        <img src="${category.image}" alt="${category.name}" class="category-image">
                        <span>${category.name}</span>
                    </div>
                    <div class="category-actions">
                        <button class="action-btn edit-btn" data-id="${category.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete-btn" data-id="${category.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
            
            // Add event listeners to category actions
            document.querySelectorAll('.category-card .edit-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const categoryId = btn.dataset.id;
                    editCategory(categoryId);
                });
            });
            
            document.querySelectorAll('.category-card .delete-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const categoryId = btn.dataset.id;
                    if (confirm('Are you sure you want to delete this category?')) {
                        deleteCategory(categoryId);
                    }
                });
            });
        }
        
        // Render promo codes list
        function renderPromoCodesList() {
            promoCodesList.innerHTML = promoCodes.map(promo => `
                <div class="promo-card">
                    <div class="promo-info">
                        <div class="promo-code">${promo.code}</div>
                        <div class="promo-value">${promo.discount} EGP discount</div>
                        <span class="promo-active-badge active-${promo.active}">${promo.active ? 'Active' : 'Inactive'}</span>
                    </div>
                    <div class="promo-actions">
                        <button class="action-btn edit-btn" data-id="${promo.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete-btn" data-id="${promo.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
            
            // Add event listeners to edit and delete buttons
            document.querySelectorAll('.promo-card .edit-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const promoId = btn.dataset.id;
                    editPromoCode(promoId);
                });
            });
            
            document.querySelectorAll('.promo-card .delete-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const promoId = btn.dataset.id;
                    if (confirm('Are you sure you want to delete this promo code?')) {
                        deletePromoCode(promoId);
                    }
                });
            });
        }
        
        // Format date from timestamp
        function formatDate(timestamp) {
            if (!timestamp) return 'N/A';
            const date = new Date(timestamp);
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
        }
        
        // Format date only (without time)
        function formatDateOnly(timestamp) {
            if (!timestamp) return 'N/A';
            const date = new Date(timestamp);
            return date.toLocaleDateString();
        }
        
        // Render orders as cards
        function renderOrdersCards() {
            ordersContainer.innerHTML = orders.map(order => {
                // Get status class based on order status
                let statusClass = '';
                switch(order.status) {
                    case 'pending': statusClass = 'status-pending'; break;
                    case 'processing': statusClass = 'status-processing'; break;
                    case 'shipped': statusClass = 'status-shipped'; break;
                    case 'delivered': statusClass = 'status-delivered'; break;
                    case 'cancelled': statusClass = 'status-cancelled'; break;
                    default: statusClass = 'status-pending';
                }
                
                return `
                <div class="order-card">
                    <div class="order-header">
                        <div class="order-id">Order #${order.id.substring(0, 8)}</div>
                        <div class="order-date">${formatDate(order.createdAt)}</div>
                    </div>
                    
                    <div class="order-customer">
                        <div class="customer-name">${order.customer?.name || 'N/A'}</div>
                        <div class="customer-details">
                            ${order.customer?.phone || ''} ${order.customer?.phone2 ? ' ' + order.customer.phone2 : ''}
                            ${order.customer?.address ? '<br>' + order.customer.address : ''}
                        </div>
                    </div>
                    
                    <div class="order-products">
                        ${order.items ? order.items.map(item => `
                            <div class="product-item">
                                <img src="${item.image || 'https://via.placeholder.com/50'}" alt="${item.name}" class="product-item-img">
                                <div class="product-item-details">
                                    <div class="product-item-name">${item.name}</div>
                                    <div class="product-item-price">${item.price} EGP x ${item.quantity}</div>
                                </div>
                                <div class="product-item-quantity">${item.quantity * item.price} EGP</div>
                            </div>
                        `).join('') : ''}
                    </div>
                    
                    <div class="order-summary">
                        <div>Subtotal:</div>
                        <div>${order.total || 0} EGP</div>
                    </div>
                    <div class="order-summary">
                        <div>Discount:</div>
                        <div>${order.discount || 0} EGP</div>
                    </div>
                    <div class="order-summary">
                        <div class="order-total">Total:</div>
                        <div class="order-total">${order.finalTotal || 0} EGP</div>
                    </div>
                    
                    <div class="order-status">
                        <div>
                            <span class="status-badge ${statusClass}">${order.status || 'pending'}</span>
                        </div>
                        ${order.status !== 'cancelled' ? `
                        <select class="status-select" data-order-id="${order.id}">
                            <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>Pending</option>
                            <option value="processing" ${order.status === 'processing' ? 'selected' : ''}>Processing</option>
                            <option value="shipped" ${order.status === 'shipped' ? 'selected' : ''}>Shipped</option>
                            <option value="delivered" ${order.status === 'delivered' ? 'selected' : ''}>Delivered</option>
                            <option value="cancelled">Cancel Order</option>
                        </select>
                        ` : ''}
                    </div>
                    
                    <button class="order-details-toggle" data-order-id="${order.id}">
                        <i class="fas fa-chevron-down"></i> View Order Details
                    </button>
                    
                    <div class="order-details-content" id="details-${order.id}">
                        <div class="detail-row">
                            <div class="detail-label">Order ID:</div>
                            <div class="detail-value">${order.id}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Customer Name:</div>
                            <div class="detail-value">${order.customer?.name || 'N/A'}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label>Order Date:</div>
                            <div class="detail-value">${formatDate(order.createdAt)}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Items:</div>
                            <div class="detail-value">
                                ${order.items ? order.items.map(item => `
                                    <div>${item.name} - ${item.quantity} x ${item.price} EGP = ${item.quantity * item.price} EGP</div>
                                `).join('') : 'N/A'}
                            </div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label>Subtotal:</div>
                            <div class="detail-value">${order.total || 0} EGP</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label>Discount:</div>
                            <div class="detail-value">${order.discount || 0} EGP</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label>Final Total:</div>
                            <div class="detail-value">${order.finalTotal || 0} EGP</div>
                        </div>
                    </div>
                </div>
                `;
            }).join('');
            
            // Add event listeners to status selects
            document.querySelectorAll('.status-select').forEach(select => {
                select.addEventListener('change', (e) => {
                    const orderId = e.target.dataset.orderId;
                    const newStatus = e.target.value;
                    
                    if (newStatus === 'cancelled') {
                        if (confirm('Are you sure you want to cancel this order? This action cannot be undone.')) {
                            updateOrderStatus(orderId, newStatus);
                        } else {
                            // Reset to previous value if user cancels
                            const order = orders.find(o => o.id === orderId);
                            e.target.value = order.status;
                        }
                    } else {
                        if (confirm(`Are you sure you want to change the order status to ${newStatus}?`)) {
                            updateOrderStatus(orderId, newStatus);
                        } else {
                            // Reset to previous value if user cancels
                            const order = orders.find(o => o.id === orderId);
                            e.target.value = order.status;
                        }
                    }
                });
            });
            
            // Add event listeners to order details toggles
            document.querySelectorAll('.order-details-toggle').forEach(toggle => {
                toggle.addEventListener('click', () => {
                    const orderId = toggle.dataset.orderId;
                    const detailsContent = document.getElementById(`details-${orderId}`);
                    const icon = toggle.querySelector('i');
                    
                    if (detailsContent.classList.contains('show')) {
                        detailsContent.classList.remove('show');
                        icon.className = 'fas fa-chevron-down';
                        toggle.innerHTML = `<i class="fas fa-chevron-down"></i> View Order Details`;
                    } else {
                        detailsContent.classList.add('show');
                        icon.className = 'fas fa-chevron-up';
                        toggle.innerHTML = `<i class="fas fa-chevron-up"></i> Hide Order Details`;
                    }
                });
            });
        }
        
        // Render reviews as a table (updated to handle reviewer names properly)
        function renderReviewsTable() {
            reviewsTableBody.innerHTML = reviews.map(review => {
                // Generate star rating
                const stars = ''.repeat(review.rating) + ''.repeat(5 - review.rating);
                
                // Get reviewer name - handle both old and new data formats
                let reviewerName = 'Anonymous';
                if (review.userName) {
                    reviewerName = review.userName;
                } else if (review.reviewerName) {
                    reviewerName = review.reviewerName;
                } else if (review.userId) {
                    reviewerName = `User ${review.userId.substring(0, 8)}`;
                }
                
                return `
                <tr>
                    <td>${review.productName || 'Unknown Product'}</td>
                    <td>${reviewerName}</td>
                    <td><span class="review-rating">${stars}</span> (${review.rating}/5)</td>
                    <td>${review.text || 'No comment provided.'}</td>
                    <td>${formatDate(review.timestamp)}</td>
                    <td>
                        <button class="action-btn delete-btn" data-id="${review.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
                `;
            }).join('');
            
            // Add event listeners to delete buttons
            document.querySelectorAll('.review-table .delete-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const reviewId = btn.dataset.id;
                    if (confirm('Are you sure you want to delete this review?')) {
                        deleteReview(reviewId);
                    }
                });
            });
        }
        
        // Render users table
        function renderUsersTable() {
            usersTableBody.innerHTML = users.map(user => `
                <tr>
                    <td>${user.name || 'N/A'}</td>
                    <td>${user.email || 'N/A'}</td>
                    <td>${user.phone || 'N/A'}</td>
                    <td>${user.registrationDate || 'N/A'}</td>
                </tr>
            `).join('');
        }
        
        // Download users as CSV
        function downloadUsersCSV() {
            if (users.length === 0) {
                alert('No users to download');
                return;
            }
            
            // Create CSV content
            let csvContent = 'Name,Email,Phone,Registration Date\n';
            
            users.forEach(user => {
                const row = [
                    user.name || '',
                    user.email || '',
                    user.phone || '',
                    user.registrationDate || ''
                ].map(field => `"${field.replace(/"/g, '""')}"`).join(',');
                
                csvContent += row + '\n';
            });
            
            // Create download link
            const blob = new Blob([csvContent], { type: 'text/css;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', 'users.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // Update category select in product form
        function updateCategorySelect() {
            productCategorySelect.innerHTML = `
                <option value="">Select a category</option>
                ${categories.map(category => `
                    <option value="${category.name}">${category.name}</option>
                `).join('')}
            `;
        }
        
        // Update analytics dashboard
        function updateAnalytics() {
            // Calculate metrics
            const deliveredOrders = orders.filter(order => order.status === 'delivered');
            const totalRevenue = deliveredOrders.reduce((sum, order) => sum + (order.finalTotal || 0), 0);
            const totalOrdersCount = orders.length;
            const deliveredOrdersCount = deliveredOrders.length;
            const avgOrderValue = deliveredOrdersCount > 0 ? totalRevenue / deliveredOrdersCount : 0;
            
            // Calculate total customers
            const customerPhones = new Set();
            orders.forEach(order => {
                if (order.customer && order.customer.phone) {
                    customerPhones.add(order.customer.phone);
                }
            });
            const totalCustomers = customerPhones.size;
            
            // Calculate conversion rate (placeholder - would need visitor data)
            const conversionRate = totalOrdersCount > 0 ? Math.min(100, Math.round((totalOrdersCount / (totalCustomers * 3)) * 100)) : 0;
            
            // Update metric cards
            totalRevenueEl.textContent = `${totalRevenue.toFixed(2)} EGP`;
            totalOrdersEl.textContent = totalOrdersCount;
            deliveredOrdersEl.textContent = deliveredOrdersCount;
            avgOrderValueEl.textContent = `${avgOrderValue.toFixed(2)} EGP`;
            totalCustomersEl.textContent = totalCustomers;
            conversionRateEl.textContent = `${conversionRate}%`;
            
            // Update charts
            updateOrdersStatusChart();
            updateRevenueChart();
            updateTopProductsChart();
            updateCategoryChart();
            updateCustomerChart();
            updateRatingsChart();
        }
        
        // Update orders status chart
        function updateOrdersStatusChart() {
            const statusCounts = {
                'pending': 0,
                'processing': 0,
                'shipped': 0,
                'delivered': 0,
                'cancelled': 0
            };
            
            orders.forEach(order => {
                const status = order.status || 'pending';
                statusCounts[status] = (statusCounts[status] || 0) + 1;
            });
            
            const ctx = document.getElementById('ordersStatusChart').getContext('2d');
            
            // Destroy previous chart if it exists
            if (ordersStatusChart) ordersStatusChart.destroy();
            
            ordersStatusChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Pending', 'Processing', 'Shipped', 'Delivered', 'Cancelled'],
                    datasets: [{
                        data: [
                            statusCounts.pending,
                            statusCounts.processing,
                            statusCounts.shipped,
                            statusCounts.delivered,
                            statusCounts.cancelled
                        ],
                        backgroundColor: [
                            '#fff3cd',
                            '#e3f2fd',
                            '#d1ecf1',
                            '#e8f5e9',
                            '#ffebee'
                        ],
                        borderColor: [
                            '#856404',
                            '#1976d2',
                            '#0c5460',
                            '#2e7d32',
                            '#c62828'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Update revenue chart
        function updateRevenueChart() {
            // Group delivered orders by month
            const deliveredOrders = orders.filter(order => order.status === 'delivered');
            const revenueByMonth = {};
            
            deliveredOrders.forEach(order => {
                if (order.createdAt) {
                    const date = new Date(order.createdAt);
                    const monthYear = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}`;
                    
                    if (!revenueByMonth[monthYear]) revenueByMonth[monthYear] = 0;
                    revenueByMonth[monthYear] += order.finalTotal || 0;
                }
            });
            
            // Sort months chronologically
            const sortedMonths = Object.keys(revenueByMonth).sort();
            const monthlyRevenue = sortedMonths.map(month => revenueByMonth[month]);
            
            // Format month labels for display
            const monthLabels = sortedMonths.map(month => {
                const [year, monthNum] = month.split('-');
                const date = new Date(year, monthNum - 1);
                return date.toLocaleString('default', { month: 'short', year: 'numeric' });
            });
            
            const ctx = document.getElementById('revenueChart').getContext('2d');
            
            // Destroy previous chart if it exists
            if (revenueChart) revenueChart.destroy();
            
            revenueChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: monthLabels,
                    datasets: [{
                        label: 'Revenue (EGP)',
                        data: monthlyRevenue,
                        backgroundColor: '#25D366',
                        borderColor: '#1da84e',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { callback: value => value + ' EGP' }
                        }
                    }
                }
            });
        }
        
        // Update top products chart
        function updateTopProductsChart() {
            // Count product sales from delivered orders
            const productSales = {};
            
            orders
                .filter(order => order.status === 'delivered')
                .forEach(order => {
                    if (order.items) {
                        order.items.forEach(item => {
                            if (!productSales[item.name]) productSales[item.name] = 0;
                            productSales[item.name] += item.quantity;
                        });
                    }
                });
            
            // Sort products by sales count
            const sortedProducts = Object.entries(productSales)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10); // Top 10 products
            
            const productNames = sortedProducts.map(item => item[0]);
            const salesCounts = sortedProducts.map(item => item[1]);
            
            const ctx = document.getElementById('topProductsChart').getContext('2d');
            
            // Destroy previous chart if it exists
            if (topProductsChart) topProductsChart.destroy();
            
            topProductsChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: productNames,
                    datasets: [{
                        label: 'Units Sold',
                        data: salesCounts,
                        backgroundColor: '#4CAF50',
                        borderColor: '#388E3C',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: { x: { beginAtZero: true } }
                }
            });
        }
        
        // Update category chart
        function updateCategoryChart() {
            // Calculate revenue by category from delivered orders
            const categoryRevenue = {};
            
            orders
                .filter(order => order.status === 'delivered')
                .forEach(order => {
                    if (order.items) {
                        order.items.forEach(item => {
                            // Find product to get its category
                            const product = products.find(p => p.name === item.name);
                            if (product) {
                                const categoryName = product.category;
                                if (!categoryRevenue[categoryName]) categoryRevenue[categoryName] = 0;
                                categoryRevenue[categoryName] += (item.price * item.quantity);
                            }
                        });
                    }
                });
            
            const categoryNames = Object.keys(categoryRevenue);
            const revenueValues = Object.values(categoryRevenue);
            
            const ctx = document.getElementById('categoryChart').getContext('2d');
            
            // Destroy previous chart if it exists
            if (categoryChart) categoryChart.destroy();
            
            categoryChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: categoryNames,
                    datasets: [{
                        data: revenueValues,
                        backgroundColor: [
                            '#FF6384',
                            '#36A2EB',
                            '#FFCE56',
                            '#4BC0C0',
                            '#9966FF',
                            '#FF9F40',
                            '#FF6384',
                            '#C9CBCF'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value.toFixed(2)} EGP (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Update customer acquisition chart
        function updateCustomerChart() {
            // Group customers by month
            const customersByMonth = {};
            
            users.forEach(user => {
                if (user.registrationDate) {
                    const date = new Date(user.registrationDate);
                    const monthYear = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}`;
                    
                    if (!customersByMonth[monthYear]) customersByMonth[monthYear] = 0;
                    customersByMonth[monthYear] += 1;
                }
            });
            
            // Sort months chronologically
            const sortedMonths = Object.keys(customersByMonth).sort();
            const monthlyCustomers = sortedMonths.map(month => customersByMonth[month]);
            
            // Format month labels for display
            const monthLabels = sortedMonths.map(month => {
                const [year, monthNum] = month.split('-');
                const date = new Date(year, monthNum - 1);
                return date.toLocaleString('default', { month: 'short', year: 'numeric' });
            });
            
            const ctx = document.getElementById('customerChart').getContext('2d');
            
            // Destroy previous chart if it exists
            if (customerChart) customerChart.destroy();
            
            customerChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: monthLabels,
                    datasets: [{
                        label: 'New Customers',
                        data: monthlyCustomers,
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { stepSize: 1 }
                        }
                    }
                }
            });
        }
        
        // Update ratings chart
        function updateRatingsChart() {
            // Count reviews by rating
            const ratingCounts = {1: 0, 2: 0, 3: 0, 4: 0, 5: 0};
            
            reviews.forEach(review => {
                const rating = Math.round(review.rating);
                if (rating >= 1 && rating <= 5) ratingCounts[rating] = (ratingCounts[rating] || 0) + 1;
            });
            
            const ratingValues = [ratingCounts[1], ratingCounts[2], ratingCounts[3], ratingCounts[4], ratingCounts[5]];
            
            const ctx = document.getElementById('ratingsChart').getContext('2d');
            
            // Destroy previous chart if it exists
            if (ratingsChart) ratingsChart.destroy();
            
            ratingsChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['1 Star', '2 Stars', '3 Stars', '4 Stars', '5 Stars'],
                    datasets: [{
                        label: 'Number of Reviews',
                        data: ratingValues,
                        backgroundColor: [
                            '#FF6384',
                            '#FF9F40',
                            '#FFCE56',
                            '#4BC0C0',
                            '#36A2EB'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { stepSize: 1 }
                        }
                    }
                }
            });
        }
        
        // Save product to Firebase (updated to only use color names)
        function saveProduct() {
            const productId = document.getElementById('productId').value;
            const productName = document.getElementById('productName').value;
            const productPrice = parseFloat(document.getElementById('productPrice').value);
            const productCategory = document.getElementById('productCategory').value;
            const description = document.getElementById('productDescription').value;
            const images = uploadedImages;
            
            // Collect colors (updated to only use color names)
            const colorElements = colorsContainer.querySelectorAll('.dynamic-field-container');
            const colors = [];
            colorElements.forEach(colorElement => {
                const name = colorElement.querySelector('.color-name').value;
                if (name) colors.push(name);
            });
            
            // Collect sizes
            const sizeElements = sizesContainer.querySelectorAll('.dynamic-field-container');
            const sizes = [];
            sizeElements.forEach(sizeElement => {
                const size = sizeElement.querySelector('.size-value').value;
                if (size) sizes.push(size);
            });
            
            if (!productName || !productPrice || !productCategory || !images || images.length === 0) {
                alert('Please fill all required fields and upload at least one image');
                return;
            }
            
            const productData = {
                name: productName,
                price: productPrice,
                category: productCategory,
                description: description,
                colors: colors,
                sizes: sizes,
                images: images
            };
            
            if (productId) {
                // Update existing product
                database.ref('products/' + productId).update(productData)
                    .then(() => {
                        alert('Product updated successfully!');
                        resetProductForm();
                    })
                    .catch(error => alert('Error updating product: ' + error.message));
            } else {
                // Add new product
                const newProductRef = database.ref('products').push();
                productData.id = newProductRef.key;
                
                newProductRef.set(productData)
                    .then(() => {
                        alert('Product added successfully!');
                        resetProductForm();
                    })
                    .catch(error => alert('Error adding product: ' + error.message));
            }
        }
        
        // Edit product (updated to handle color names only)
        function editProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            document.getElementById('productId').value = product.id;
            document.getElementById('productName').value = product.name;
            document.getElementById('productPrice').value = product.price;
            document.getElementById('productCategory').value = product.category;
            document.getElementById('productDescription').value = product.description || '';
            
            // Update image preview
            imagePreview.innerHTML = '';
            uploadedImages = product.images || [];
            
            if (product.images && product.images.length > 0) {
                product.images.forEach(image => addImagePreview(image, 'product'));
            }
            
            // Update colors (handle both old and new format)
            colorsContainer.innerHTML = '';
            if (product.colors && product.colors.length > 0) {
                product.colors.forEach(color => {
                    // Handle both old format (object with name) and new format (string)
                    if (typeof color === 'object') {
                        addColorField(color.name);
                    } else {
                        addColorField(color);
                    }
                });
            } else {
                addColorField(); // Add one empty color field
            }
            
            // Update sizes
            sizesContainer.innerHTML = '';
            if (product.sizes && product.sizes.length > 0) {
                product.sizes.forEach(size => addSizeField(size));
            } else {
                addSizeField(); // Add one empty size field
            }
        }
        
        // Delete product
        function deleteProduct(productId) {
            database.ref('products/' + productId).remove()
                .then(() => alert('Product deleted successfully!'))
                .catch(error => alert('Error deleting product: ' + error.message));
        }
        
        // Add category
        function addCategory() {
            const categoryName = document.getElementById('categoryName').value.trim();
            const categoryImage = uploadedCategoryImage;
            
            if (!categoryName) {
                alert('Please enter a category name');
                return;
            }
            
            if (!categoryImage) {
                alert('Please upload a category image');
                return;
            }
            
            // Check if category already exists
            if (categories.some(c => c.name.toLowerCase() === categoryName.toLowerCase())) {
                alert('Category already exists');
                return;
            }
            
            // Create a new category reference
            const newCategoryRef = database.ref('categories').push();
            
            const categoryData = {
                id: newCategoryRef.key,
                name: categoryName,
                image: categoryImage
            };
            
            // Save the category data
            newCategoryRef.set({ 
                name: categoryName,
                image: categoryImage
            })
            .then(() => {
                alert('Category added successfully!');
                categoryForm.reset();
                categoryImagePreview.innerHTML = '';
                uploadedCategoryImage = null;
            })
            .catch(error => alert('Error adding category: ' + error.message));
        }
        
        // Edit category
        function editCategory(categoryId) {
            const category = categories.find(c => c.id === categoryId);
            if (!category) return;
            
            const newName = prompt('Enter new category name:', category.name);
            if (newName && newName.trim() && newName !== category.name) {
                database.ref('categories/' + categoryId).update({ name: newName.trim() })
                    .then(() => alert('Category updated successfully!'))
                    .catch(error => alert('Error updating category: ' + error.message));
            }
        }
        
        // Delete category
        function deleteCategory(categoryId) {
            // First check if any products use this category
            const category = categories.find(c => c.id === categoryId);
            const productsInCategory = products.filter(p => p.category === category.name);
            
            if (productsInCategory.length > 0) {
                alert('Cannot delete this category because it has products assigned to it.');
                return;
            }
            
            database.ref('categories/' + categoryId).remove()
                .then(() => alert('Category deleted successfully!'))
                .catch(error => alert('Error deleting category: ' + error.message));
        }
        
        // Add promo code
        function addPromoCode() {
            const code = document.getElementById('promoCode').value.trim().toUpperCase();
            const discount = parseFloat(document.getElementById('promoDiscount').value);
            const active = document.getElementById('promoActive').checked;
            
            if (!code || isNaN(discount) || discount <= 0) {
                alert('Please enter a valid promo code and discount value');
                return;
            }
            
            // Check if promo code already exists
            if (promoCodes.some(p => p.code === code)) {
                alert('Promo code already exists');
                return;
            }
            
            // Create a new promo code reference
            const newPromoRef = database.ref('promoCodes').push();
            
            const promoData = {
                id: newPromoRef.key,
                code: code,
                discount: discount,
                active: active
            };
            
            // Save the promo code data
            newPromoRef.set({ 
                code: code,
                discount: discount,
                active: active
            })
            .then(() => {
                alert('Promo code added successfully!');
                promoCodeForm.reset();
                document.getElementById('promoActive').checked = true;
            })
            .catch(error => alert('Error adding promo code: ' + error.message));
        }
        
        // Edit promo code
        function editPromoCode(promoId) {
            const promo = promoCodes.find(p => p.id === promoId);
            if (!promo) return;
            
            const newCode = prompt('Enter new promo code:', promo.code);
            if (!newCode || !newCode.trim()) return;
            
            const newDiscount = parseFloat(prompt('Enter new discount value:', promo.discount));
            if (isNaN(newDiscount) || newDiscount <= 0) {
                alert('Please enter a valid discount value');
                return;
            }
            
            const newActive = confirm('Would you like to keep this promo code active?');
            
            database.ref('promoCodes/' + promoId).update({ 
                code: newCode.trim().toUpperCase(),
                discount: newDiscount,
                active: newActive
            })
            .then(() => alert('Promo code updated successfully!'))
            .catch(error => alert('Error updating promo code: ' + error.message));
        }
        
        // Delete promo code
        function deletePromoCode(promoId) {
            database.ref('promoCodes/' + promoId).remove()
                .then(() => alert('Promo code deleted successfully!'))
                .catch(error => alert('Error deleting promo code: ' + error.message));
        }
        
        // Update order status
        function updateOrderStatus(orderId, status) {
            database.ref('orders/' + orderId).update({ status: status })
                .then(() => alert('Order status updated successfully!'))
                .catch(error => alert('Error updating order status: ' + error.message));
        }
        
        // Delete review
        function deleteReview(reviewId) {
            database.ref('reviews/' + reviewId).remove()
                .then(() => alert('Review deleted successfully!'))
                .catch(error => alert('Error deleting review: ' + error.message));
        }
        
        // Initialize the admin panel when the page loads
        window.addEventListener('DOMContentLoaded', initAdminPanel);
    </script>
</body>
</html>